<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Free Fire Challenge</title>
    <style>
        body { background: #000; color: white; font-family: sans-serif; text-align: center; margin: 0; user-select: none; }
        .container { padding: 10px; max-width: 500px; margin: auto; }
        h1 { color: #ffd700; font-size: 20px; }
        #timer-box { font-size: 24px; padding: 10px; background: #222; border-radius: 8px; border: 1px solid #444; margin: 10px; display: inline-block; min-width: 100px; }
        .timer-normal { color: #0f0; }
        .timer-danger { color: #f00; animation: blink 0.8s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        #puzzle-board { display: grid; gap: 2px; margin: 10px auto; width: 95vw; height: 95vw; max-width: 400px; max-height: 400px; background: #111; border: 2px solid #333; }
        .tile { background-repeat: no-repeat; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }
        .selected { border: 3px solid #0f0 !important; box-shadow: 0 0 15px #0f0; }
        
        /* Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
        #next-lvl-btn { 
            background: #444 !important; color: #888 !important; 
            border: none; padding: 15px; font-size: 18px; font-weight: bold; 
            border-radius: 30px; width: 90%; margin-top: 20px; 
            cursor: not-allowed; pointer-events: none; transition: all 0.3s;
        }

        /* Ø§Ù„Ø²Ø± Ø§Ù„Ø£Ø®Ø¶Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­ */
        #next-lvl-btn.active { 
            background: linear-gradient(180deg, #28a745, #1e7e34) !important; 
            color: white !important; cursor: pointer !important; 
            pointer-events: auto !important; box-shadow: 0 0 20px #28a745; 
            border: 2px solid #fff !important; opacity: 1 !important;
        }

        .hidden { display: none !important; }
        #preview-img { width: 80%; border: 3px solid #ffd700; border-radius: 8px; margin: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="title">Free Fire Token</h1>
    <div id="info">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: <span id="lvl">1</span></div>
    <div id="timer-box" class="timer-normal">02:00</div>

    <div id="preview-screen">
        <p>Ø§Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¬ÙŠØ¯Ø§Ù‹...</p>
        <img id="preview-img" src="">
    </div>

    <div id="game-screen" class="hidden">
        <div id="puzzle-board"></div>
        <button id="next-lvl-btn" onclick="goToNext()">LEVEL 2</button>
    </div>

    <div id="fail-screen" class="hidden">
        <h2 style="color:red">Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!</h2>
        <button onclick="startLevel()" style="padding:10px 20px; background:orange; border:none; border-radius:10px;">Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>

    <div id="final-screen" class="hidden">
        <h2 style="color:#ffd700">ğŸ† Ø¨Ø·Ù„ Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ± ğŸ†</h2>
        <a href="https://t.me/Free_Fire_121"><button style="padding:15px; background:green; color:white; border-radius:10px; border:none;">Ø§Ø³ØªÙ„Ù… Ø§Ù„Ø¬ÙˆØ§Ù‡Ø± Ø§Ù„Ø¢Ù†</button></a>
    </div>
</div>

<script>
    const levels = [
        { img: 'https://i.ibb.co/MkbtPcTW/image.jpg', r: 3, c: 4 },
        { img: 'https://i.ibb.co/6RTSMPfy/image.jpg', r: 3, c: 6 },
        { img: 'https://i.ibb.co/F42mpCrd/image.jpg', r: 6, c: 8 },
        { img: 'https://i.ibb.co/xKHHNRMH/image.jpg', r: 8, c: 12 },
        { img: 'https://i.ibb.co/F42mpCrd/image.jpg', r: 10, c: 15 }
    ];

    let currentLvl = 0, firstTile = null, timer = null, timeLeft = 120;

    function startLevel() {
        clearInterval(timer);
        const l = levels[currentLvl];
        document.getElementById('lvl').innerText = currentLvl + 1;
        document.getElementById('preview-img').src = l.img;
        
        // ØªØµÙÙŠØ± Ø§Ù„Ø²Ø±
        const btn = document.getElementById('next-lvl-btn');
        btn.classList.remove('active');
        btn.innerText = currentLvl === levels.length - 1 ? "CLAIM REWARD" : "LEVEL " + (currentLvl + 2);

        document.getElementById('preview-screen').classList.remove('hidden');
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('fail-screen').classList.add('hidden');

        setTimeout(() => {
            document.getElementById('preview-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            setupBoard();
            runTimer();
        }, 3000);
    }

    function setupBoard() {
        const l = levels[currentLvl], board = document.getElementById('puzzle-board');
        board.style.gridTemplateRows = `repeat(${l.r}, 1fr)`;
        board.style.gridTemplateColumns = `repeat(${l.c}, 1fr)`;
        board.innerHTML = '';
        
        let ids = Array.from({length: l.r * l.c}, (_, i) => i);
        let shuffled = [...ids].sort(() => Math.random() - 0.5);

        shuffled.forEach(id => {
            const tile = document.createElement('div');
            tile.className = 'tile';
            tile.style.backgroundImage = `url(${l.img})`;
            tile.style.backgroundSize = `${l.c * 100}% ${l.r * 100}%`;
            
            let r = Math.floor(id / l.c), c = id % l.c;
            tile.style.backgroundPosition = `${(c / (l.c - 1)) * 100}% ${(r / (l.r - 1)) * 100}%`;
            tile.dataset.id = id;

            tile.onclick = () => {
                if (document.getElementById('next-lvl-btn').classList.contains('active')) return;
                if (!firstTile) {
                    firstTile = tile;
                    tile.classList.add('selected');
                } else {
                    let tId = firstTile.dataset.id, tBg = firstTile.style.backgroundPosition;
                    firstTile.dataset.id = tile.dataset.id;
                    firstTile.style.backgroundPosition = tile.style.backgroundPosition;
                    tile.dataset.id = tId;
                    tile.style.backgroundPosition = tBg;
                    firstTile.classList.remove('selected');
                    firstTile = null;
                    check();
                }
            };
            board.appendChild(tile);
        });
    }

    function check() {
        const tiles = Array.from(document.querySelectorAll('.tile'));
        // ÙØ­Øµ ØµØ§Ø±Ù…: Ù‡Ù„ ÙƒÙ„ ØªØ§ÙŠØªÙ„ ÙÙŠ Ù…ÙƒØ§Ù†Ù‡ Ø§Ù„ØµØ­ÙŠØ­ØŸ
        const isWin = tiles.every((t, i) => parseInt(t.dataset.id) === i);
        if (isWin) {
            clearInterval(timer);
            const btn = document.getElementById('next-lvl-btn');
            btn.classList.add('active'); // Ø¥Ø¬Ø¨Ø§Ø± Ø¸Ù‡ÙˆØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø±
        }
    }

    function runTimer() {
        timeLeft = 120;
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft / 60), s = timeLeft % 60;
            const box = document.getElementById('timer-box');
            box.innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            box.className = timeLeft <= 30 ? 'timer-danger' : 'timer-normal';
            if (timeLeft <= 0) {
                clearInterval(timer);
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('fail-screen').classList.remove('hidden');
            }
        }, 1000);
    }

    function goToNext() {
        if (currentLvl < levels.length - 1) {
            currentLvl++;
            startLevel();
        } else {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('final-screen').classList.remove('hidden');
        }
    }

    window.onload = startLevel;
</script>
</body>
</html>
